package com.redhat.ecosystemappeng.model.osv;

import static com.redhat.ecosystemappeng.service.cve.CveFileService.CVE_PATTERN;

import java.util.ArrayList;
import java.util.Collections;
import java.util.Date;
import java.util.List;

public record OsvVulnerability(String id, String summary, String details, List<String> aliases, Date published,
    Date modified, List<Affected> affected) {

  public OsvVulnerability {
    if (!CVE_PATTERN.matcher(id).matches() && aliases != null && !aliases.isEmpty()) {
      List<String> newAliases = new ArrayList<>();
      newAliases.add(id);
      for (String alias : aliases) {
        if (CVE_PATTERN.matcher(alias).matches()) {
          id = alias;
        } else {
          newAliases.add(alias);
        }
      }
      aliases = Collections.unmodifiableList(newAliases);
    }
  }

}
